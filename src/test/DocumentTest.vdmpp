class DocumentTest is subclass of Test

operations

	 	public createClient: () ==> Client
 		createClient() ==
 		(
 			dcl manager:PrintManager;
 			dcl cli:Client;
 			manager := PrintManager`getInstance();
 			cli := manager.addClient("utilizador","12345678",10.0);
 			return cli;
 		);

	public createDocument: () ==> Document
		createDocument() ==
		(
			dcl doc: Document := new Document(createClient(), <A4>,<BlackWhite>,<Portrait>,"Teste", mk_Document`Date(21,12,2024), 2);
			return doc;
		);
		
 	public createEmployee: () ==> Employee
 		createEmployee() ==
 		(
 			dcl manager:PrintManager;
 			dcl emp:Employee;
 			dcl empCreated: bool;
 			dcl admin: Employee;
 			manager := PrintManager`getInstance();
 			admin := manager.login("admin", "admin");
 			empCreated := manager.addEmployee("empregado","emp12345",<Regular>);
 			assertTrue(empCreated);
 			PrintManager`getInstance().logout();
 			emp := manager.login("empregado", "emp12345");
 			return emp;
 		);
 		
 		
 	public createQueue: () ==> Queue
 		createQueue() ==
 		(
 				return PrintManager`getInstance().addQueue(<A4>,<BlackWhite>);
 		);
	
	
	-- Normal scenario for loading (adding) a document
	-- as described in section 1.2 of the report, covering requirement R3.	
	public testDocument: () ==> ()
		testDocument() ==
		(
			 	dcl doc:Document;
 				PrintManager`clearInstance();
 				IO`print("Test Document - create (A4, B&W)\n");
 				doc := createDocument();
 				assertEqual(doc.getColor(), <BlackWhite>);
 				assertEqual(doc.getSize(), <A4>);
 				assertEqual(doc.getClient().getName(), "utilizador");
 				assertEqual(doc.getPrice(), 0.08);
 				assertEqual(doc.getName(), "Teste");
 				assertEqual(doc.getDate(), mk_Document`Date(21,12,2024));
 				assertEqual(doc.getPrinted(), <ToPrint>);
		);
 	
 	-- Normal scenario for loading (adding) a document with alternative size and/or color
 	public testPriceOtherOptions: () ==> ()
 		testPriceOtherOptions() ==
 		(
 			dcl doc:Document;
 			dcl doc2: Document;
 			dcl doc3: Document;
 			dcl cli: Client;
 			PrintManager`clearInstance();
 			IO`print("Test Document - create (A3-Colors and A3-B&W and A4-Colors)\n");
 			cli := createClient();
 			doc := new Document(cli, <A3>,<Colors>,<Portrait>,"Teste", mk_Document`Date(21,12,2021), 2);
 			doc2 := new Document(cli, <A3>,<BlackWhite>,<Portrait>,"Teste2", mk_Document`Date(21,12,2021), 2);
 			doc3 := new Document(cli, <A4>,<Colors>,<Portrait>,"Test3", mk_Document`Date(21,12,2021), 2);
 			assertEqual(doc.getPrice(), 0.18);
 			assertEqual(doc2.getPrice(), 0.14);
 			assertEqual(doc3.getPrice(), 0.12);
 		);
 		
 	 -- Normal scenario for adding the current document to a printing queue
	 public testAddtoQueue: () ==> ()
			testAddtoQueue() ==
			(
				 	dcl doc:Document;
				 	dcl emp: Employee;
				 	dcl queue: Queue;
	 				PrintManager`clearInstance();
	 				IO`print("Test Document - add queue\n");
	 				emp := createEmployee();
	 				queue := createQueue();
	 				PrintManager`getInstance().logout();
	 				doc := createDocument();
	 				queue.addDocument(doc);
	 				doc.setQueue(queue);
	 				assertEqual(doc.getQueue().getSize(), <A4>);
	 				assertEqual(doc.getQueue().getColor(), <BlackWhite>);
	 				PrintManager`getInstance().logout();
	 				emp := PrintManager`getInstance().login("empregado","emp12345");
	 				assertEqual(doc.getName(), "Teste");
 					assertEqual(doc.getDate(), mk_Document`Date(21,12,2024));
			);
		
		-- Normal scenario for removing the current document from the printing queue
		 public testRemovefromQueue: () ==> ()
			testRemovefromQueue() ==
			(
				 	dcl doc:Document;
				 	dcl emp: Employee;
				 	dcl queue: Queue;
	 				PrintManager`clearInstance();
	 				IO`print("Test Document - remove queue");
	 				emp := createEmployee();
	 				queue := createQueue();
	 				PrintManager`getInstance().logout();
	 				doc := createDocument();
	 				queue.addDocument(doc);
	 				doc.setQueue(queue);
	 				assertEqual(doc.getQueue().getSize(), <A4>);
					queue := doc.removeFromQueue();
	 				assertEqual(not doc in set doc.getQueue().getDocs(), true);	
			);

			
	
	public test: () ==> ()
 		test() ==
 			(
 				testDocument();
 				testPriceOtherOptions();
 				testAddtoQueue();
 				testRemovefromQueue();
 			);
			
	

end DocumentTest